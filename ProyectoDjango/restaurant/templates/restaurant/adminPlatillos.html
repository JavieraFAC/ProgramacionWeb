{% extends 'restaurant/base.html' %}

{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Admin Platillos</h2>

    <!-- Formulario de creación/actualización -->
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-primary text-white">
            <h3 id="form-title" style="color: black;">Crear Producto</h3>
        </div>
        <div class="card-body">
            <form id="product-form" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="hidden" name="producto_id" id="producto_id">
                <button type="submit" name="crear" id="submit-button" class="btn btn-success mt-3">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Lista de productos -->
    <h3 class="mb-4">Lista de Productos</h3>
    <div class="row">
        {% for producto in productos %}
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm h-100">
                {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" class="card-img-top" alt="{{ producto.nombre }}" style="height: 200px; object-fit: cover;">
                {% else %}
                    <img src="{% static 'restaurant/default_image.jpg' %}" class="card-img-top" alt="Imagen por defecto" style="height: 200px; object-fit: cover;">
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title" style="max-height: 3.6em; overflow: hidden;">{{ producto.nombre }}</h5>
                    <p class="card-text">{{ producto.precio }}</p>
                    <button class="btn btn-warning mr-1" style="opacity: 0.8; margin-bottom: 2%;" onclick="editarProducto('{{ producto.id }}', '{{ producto.nombre }}', '{{ producto.precio }}', '{{ producto.categorias.id }}', '{{ producto.disponibilidad|yesno:"true,false" }}')">Editar</button>


                    <form action="" method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="producto_id" value="{{ producto.id }}">
                        <button type="submit" name="eliminar" class="btn btn-danger" style="opacity: 0.8;">Eliminar</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    function editarProducto(id, nombre, precio, categoriaId, disponibilidad) {
        document.getElementById('form-title').innerText = "Actualizar Producto";
        document.getElementById('submit-button').innerText = "Actualizar";
        document.getElementById('submit-button').name = "actualizar";
        document.getElementById('producto_id').value = id;
        document.getElementById('id_nombre').value = nombre;
        document.getElementById('id_precio').value = precio;
        document.getElementById('id_categorias').value = categoriaId;
        document.getElementById('id_disponibilidad').checked = disponibilidad;
        window.scrollTo(0, document.getElementById('product-form').offsetTop);
    }
</script>

{% endblock %}